NDAS device driver and sample administration tools 
    for Toshiba TX49xx, Linux 2.6 kernels
    version 0.9.4
    2005/06/13

0. Overview
   This driver is built to support Toshiba TX49xx MIPS CPU and Linux 2.6 kernels. This driver is in a beta state and some of the features are limited. The driver is composed of OS independent NDAS library("libndas.a" file. source code is not provided) and OS dependent source code. You can customize the source code according to the OS platform and requirement. And if you need changes in NDAS library or have feature request, please contact Ximeta, Inc.

1. Prerequisites
 * Prerequisites for HOST(development) machine
   - Kernel-source configured for TX49xx big-endian.
   - Cross-compiler for TX49xx.
 * Target Kernel configuration
   - /proc file system support

2. Building
 * Change configurations in Makefile.
   - Set NDAS_CROSS_COMPILE to proper compiler
   - Set NDAS_KERNEL_VERSION to the version of kernel.
   - Set NDAS_KERNEL_PATH to the kernel path. Because build process uses kernel's make rules, kernel source should be properly configured.
 * Change optional configurations
   - Change ndas-app-ldflags if you want use shared library for application.
   - Change ndas-kernel-cflags "NDAS_IO_UNIT". This value means maximum transfer size in kbytes. Change this value according to ethernet hardware buffer size. Maximum value is 64. Usually 32 works for most environment, but reduce the number if performance is reduced by packet loss.
 * Run make in source directory.

3. Install & Running
 * Boot the target board.
 * Create device files using 'mknod.sh' script included in driver release.
 * Install modules: 
   insmod ndas_sal.ko; insmod ndas_core.ko; insmod ndas_block.ko
 * Start driver
   ndasadmin start
 * Register disk
   ndasadmin register XXXXX-XXXXX-XXXXX-XXXXX-WWWWW -n DiskName
 * Enable disk with slot number that is returned by registering. Enabled device is mapped to device file /dev/nda, /dev/ndb and each partition is mapped to /dev/nda1, /dev/nda2 and so on.
   ndasadmin enable -s 1 -o w
 * You can see the /proc/ndas/slots and devs file for current status of the registered netdisks.
 * fdisk or mount
   mount -t vfat /dev/nda1 mnt_point

4. ndasadmin
 * ndasadmin is a sample administration tools for controlling NDAS device driver.
 * Execute ndasadmin for help. 

5. Limitations
 * We separated modules only to remove proprietary source code's dependency on LINUX GPL sources.You may merge three modules into one by modifying Makefile.  
 * User to kernel interface is not fixed and stabilized yet.
 * Currently this driver is tested on the RBTX4938 reference board with CE Linux 2.6.10 patched for RBTX49xx platform using ET1 ethernet port.
 * Shared-writing on current NDAS device requires coordinations between hosts. MS Windows to non MS-windows sharing implementation is on the progress.
 * Disk aggregation/mirroring/RAID implemented on MS windows is not supported.

6. Misc.
 * Compiler flags used for building NDAS binary is 
    "-mlong-calls -fomit-frame-pointer -pipe -fno-builtin-sprintf -fno-builtin-log2 -fno-builtin-puts -fno-strict-aliasing -msoft-float -fno-common -O2  -fno-builtin -nostdinc -nostdlib -ffunction-sections -fdata-sections -fno-strict-aliasing -fno-common -G 0 -mno-abicalls -fno-pic -mabi=32 -march=r4600 -Wa,-32 -Wa,-march=r4600 -Wa,-mips3 -Wa,--trap -Wall". 
Some differences in the flags may not compatible with the kernel, in that case please contact Ximeta for new binary.

7. Changes
 * Version 0.9.4
    Minor bug fixes.
 * Version 0.9.3
    Fixed problems that make kernel panic when communicate with PC side software.
 * Version 0.9.2
    Fixed problems that driver hangs while reading.
    Minor bug fixes.
 * Version 0.9.0 
    Write-performance optimization. Fixed a problem that hang. Fixed a problem using VFAT in Linux 2.6 kernel.
    Reconnection funtion is enabled. 
 * Version 0.0.3 Release 4
    Optimized performance
 * Version 0.0.3 Release 3 
    Changed /dev/ndas special files minor number to 128. You need to rerun mknod.sh
    Fixed a problem that incorrectly reports disk capacity.
    Added /proc/ndas/slots, /proc/ndas/devs proc files. These files show user-readable information about registered netdisks.
    Fixed a problem that IO blocks when disk is disconnected.
    Fixed not to attempt to connect if device is not online.(Only when the ndas_core is built with device detection function)
    Fixed some memory leaks.

